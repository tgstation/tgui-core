import*as t from"react/jsx-runtime";import*as e from"react";import*as s from"../common/keycodes.js";import*as i from"../common/math.js";import*as n from"../common/react.js";import*as r from"./Box.js";let a=(t,e,s,n)=>{let r=n?Number.parseFloat(t):Number.parseInt(t,10);if(!Number.isNaN(r)&&("."!==t.slice(-1)||r<Math.floor(e))){let t=(0,i.clamp)(r,e,s);if(r!==t)return String(t)}return t};function l(t,e){let s=e.indexOf(t),i=e.length,n=e;if(-1!==s&&s<i-1){let r=e.slice(s+1,i);r=r.replaceAll(t,""),n=e.slice(0,s+1).concat(r)}return n}function o(t,e,s,n){let r=e||0;if(!t||!t.length)return String(r);let a=n?Number.parseFloat(t.replace(/[^\-\d.]/g,"")):Number.parseInt(t.replace(/[^\-\d]/g,""),10);return Number.isNaN(a)?String(r):String((0,i.clamp)(a,r,s||0===s?s:1e4))}class p extends e.Component{constructor(t){super(t),this.inputRef=(0,e.createRef)(),this.state={editing:!1},this.handleBlur=t=>{let{maxValue:e,minValue:s,onBlur:i,allowFloats:n}=this.props,{editing:r}=this.state;r&&this.setEditing(!1);let a=o(t.target.value,s,e,n);i&&i(t,+a)},this.handleChange=t=>{let{maxValue:e,minValue:s,onChange:i,allowFloats:n}=this.props;t.target.value=function(t,e,s,i){let n=e||0,r=s||0===s?s:1e4,o=i?t.replace(/[^\-\d.]/g,""):t.replace(/[^\-\d]/g,"");return(i&&(o=l(".",o=function(t,e){let s=t,i=Math.sign(e)*Math.floor(Math.abs(e));return 0===t.indexOf(".")?s=String(i).concat(t):0===t.indexOf("-")&&1===t.indexOf(".")&&(s=i+".".concat(t.slice(2))),s}(o,n))),o=e<0?l("-",o=function(t){let e=t,s=t.indexOf("-");if(s>0){let s=t.replace("-","");e="-".concat(s)}else 0===s&&t.indexOf("-",s+1)>0&&(e=t.replaceAll("-",""));return e}(o)):o.replaceAll("-",""),n<=1&&r>=0)?a(o,n,r,i):o}(t.target.value,s,e,n),i&&i(t,+t.target.value)},this.handleFocus=t=>{let{editing:e}=this.state;e||this.setEditing(!0)},this.handleInput=t=>{let{editing:e}=this.state,{onInput:s}=this.props;e||this.setEditing(!0),s&&s(t,+t.target.value)},this.handleKeyDown=t=>{let{maxValue:e,minValue:i,onChange:n,onEnter:r,allowFloats:a}=this.props;if(t.keyCode===s.KEY_ENTER){let s=o(t.target.value,i,e,a);this.setEditing(!1),n&&n(t,+s),r&&r(t,+s),t.target.blur();return}if(t.keyCode===s.KEY_ESCAPE)return this.props.onEscape?void this.props.onEscape(t):(this.setEditing(!1),t.target.value=this.props.value,void t.target.blur())}}componentDidMount(){let{maxValue:t,minValue:e,allowFloats:s}=this.props,i=this.props.value?.toString(),n=this.inputRef.current;n&&(n.value=o(i,e,t,s)),(this.props.autoFocus||this.props.autoSelect)&&setTimeout(()=>{n.focus(),this.props.autoSelect&&n.select()},1)}componentDidUpdate(t,e){let{maxValue:s,minValue:i,allowFloats:n}=this.props,{editing:r}=this.state,a=t.value?.toString(),l=this.props.value?.toString(),p=this.inputRef.current;p&&!r&&l!==a&&l!==p.value&&(p.value=o(l,i,s,n))}setEditing(t){this.setState({editing:t})}render(){let{props:e}=this,{onChange:s,onEnter:i,onInput:a,onBlur:l,value:o,...p}=e,{className:u,fluid:h,monospace:c,...d}=p;return(0,t.jsxs)(r.Box,{className:(0,n.classes)(["Input",h&&"Input--fluid",c&&"Input--monospace",u]),...d,children:[(0,t.jsx)("div",{className:"Input__baseline",children:"."}),(0,t.jsx)("input",{className:"Input__input",onChange:this.handleChange,onInput:this.handleInput,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,ref:this.inputRef,type:"number | string"})]})}}export{p as RestrictedInput};